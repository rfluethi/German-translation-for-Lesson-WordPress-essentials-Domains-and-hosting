name: Create and upload ZIP files for release

on:
  release:
    types: [created]
  workflow_dispatch:

permissions:
  contents: write
  packages: write

jobs:
  zip_and_upload:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Debugging: Zeige Verzeichnisstruktur
      - name: List repository structure
        run: |
          echo "Current directory content:"
          ls -la
          echo "\nDocs directory content (if exists):"
          ls -la docs || echo "docs directory not found"

      # Create ZIP files
      - name: Create docs ZIP
        run: |
          if [ -d "docs" ]; then
            echo "Docs directory exists"
            if [ "$(ls -A docs)" ]; then
              echo "Docs directory is not empty"
              echo "Creating ZIP for documents..."
              mkdir -p zip
              zip -r zip/tutorial-docs.zip docs
              echo "ZIP file created. Content of zip directory:"
              ls -la zip/
              echo "docs_zip_exists=true" >> $GITHUB_ENV
            else
              echo "::warning::Docs directory is empty"
              echo "docs_zip_exists=false" >> $GITHUB_ENV
            fi
          else
            echo "::warning::Docs directory does not exist"
            echo "docs_zip_exists=false" >> $GITHUB_ENV
          fi

      # Upload nur bei einem Release
      - name: Upload to Release
        if: github.event_name == 'release' && env.docs_zip_exists == 'true'
        uses: softprops/action-gh-release@v1
        with:
          files: zip/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # Artifact Upload für manuelle Ausführung
      - name: Upload Artifact
        if: github.event_name == 'workflow_dispatch' && env.docs_zip_exists == 'true'
        uses: actions/upload-artifact@v4
        with:
          name: tutorial-zips
          path: zip/*.zip
